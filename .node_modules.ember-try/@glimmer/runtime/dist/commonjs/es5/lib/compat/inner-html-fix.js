"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.domChanges = domChanges;
exports.treeConstruction = treeConstruction;

var _bounds = require("../bounds");

var _helper = require("../dom/helper");

function _defaults(obj, defaults) {
    var keys = Object.getOwnPropertyNames(defaults);for (var i = 0; i < keys.length; i++) {
        var key = keys[i];var value = Object.getOwnPropertyDescriptor(defaults, key);if (value && value.configurable && obj[key] === undefined) {
            Object.defineProperty(obj, key, value);
        }
    }return obj;
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }return call && (typeof call === "object" || typeof call === "function") ? call : self;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);
}

var innerHTMLWrapper = {
    colgroup: { depth: 2, before: '<table><colgroup>', after: '</colgroup></table>' },
    table: { depth: 1, before: '<table>', after: '</table>' },
    tbody: { depth: 2, before: '<table><tbody>', after: '</tbody></table>' },
    tfoot: { depth: 2, before: '<table><tfoot>', after: '</tfoot></table>' },
    thead: { depth: 2, before: '<table><thead>', after: '</thead></table>' },
    tr: { depth: 3, before: '<table><tbody><tr>', after: '</tr></tbody></table>' }
};
// Patch:    innerHTML Fix
// Browsers: IE9
// Reason:   IE9 don't allow us to set innerHTML on col, colgroup, frameset,
//           html, style, table, tbody, tfoot, thead, title, tr.
// Fix:      Wrap the innerHTML we are about to set in its parents, apply the
//           wrapped innerHTML on a div, then move the unwrapped nodes into the
//           target position.
function domChanges(document, DOMChangesClass) {
    if (!document) return DOMChangesClass;
    if (!shouldApplyFix(document)) {
        return DOMChangesClass;
    }
    var div = document.createElement('div');
    return function (_DOMChangesClass) {
        _inherits(DOMChangesWithInnerHTMLFix, _DOMChangesClass);

        function DOMChangesWithInnerHTMLFix() {
            _classCallCheck(this, DOMChangesWithInnerHTMLFix);

            return _possibleConstructorReturn(this, _DOMChangesClass.apply(this, arguments));
        }

        DOMChangesWithInnerHTMLFix.prototype.insertHTMLBefore = function insertHTMLBefore(parent, nextSibling, html) {
            if (html === null || html === '') {
                return _DOMChangesClass.prototype.insertHTMLBefore.call(this, parent, nextSibling, html);
            }
            var parentTag = parent.tagName.toLowerCase();
            var wrapper = innerHTMLWrapper[parentTag];
            if (wrapper === undefined) {
                return _DOMChangesClass.prototype.insertHTMLBefore.call(this, parent, nextSibling, html);
            }
            return fixInnerHTML(parent, wrapper, div, html, nextSibling);
        };

        return DOMChangesWithInnerHTMLFix;
    }(DOMChangesClass);
}
function treeConstruction(document, DOMTreeConstructionClass) {
    if (!document) return DOMTreeConstructionClass;
    if (!shouldApplyFix(document)) {
        return DOMTreeConstructionClass;
    }
    var div = document.createElement('div');
    return function (_DOMTreeConstructionC) {
        _inherits(DOMTreeConstructionWithInnerHTMLFix, _DOMTreeConstructionC);

        function DOMTreeConstructionWithInnerHTMLFix() {
            _classCallCheck(this, DOMTreeConstructionWithInnerHTMLFix);

            return _possibleConstructorReturn(this, _DOMTreeConstructionC.apply(this, arguments));
        }

        DOMTreeConstructionWithInnerHTMLFix.prototype.insertHTMLBefore = function insertHTMLBefore(parent, referenceNode, html) {
            if (html === null || html === '') {
                return _DOMTreeConstructionC.prototype.insertHTMLBefore.call(this, parent, referenceNode, html);
            }
            var parentTag = parent.tagName.toLowerCase();
            var wrapper = innerHTMLWrapper[parentTag];
            if (wrapper === undefined) {
                return _DOMTreeConstructionC.prototype.insertHTMLBefore.call(this, parent, referenceNode, html);
            }
            return fixInnerHTML(parent, wrapper, div, html, referenceNode);
        };

        return DOMTreeConstructionWithInnerHTMLFix;
    }(DOMTreeConstructionClass);
}
function fixInnerHTML(parent, wrapper, div, html, reference) {
    var wrappedHtml = wrapper.before + html + wrapper.after;
    div.innerHTML = wrappedHtml;
    var parentNode = div;
    for (var i = 0; i < wrapper.depth; i++) {
        parentNode = parentNode.childNodes[0];
    }

    var _moveNodesBefore = (0, _helper.moveNodesBefore)(parentNode, parent, reference),
        first = _moveNodesBefore[0],
        last = _moveNodesBefore[1];

    return new _bounds.ConcreteBounds(parent, first, last);
}
function shouldApplyFix(document) {
    var table = document.createElement('table');
    try {
        table.innerHTML = '<tbody></tbody>';
    } catch (e) {} finally {
        if (table.childNodes.length !== 0) {
            // It worked as expected, no fix required
            return false;
        }
    }
    return true;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21wYXQvaW5uZXItaHRtbC1maXguanMiXSwibmFtZXMiOlsiQ29uY3JldGVCb3VuZHMiLCJtb3ZlTm9kZXNCZWZvcmUiLCJpbm5lckhUTUxXcmFwcGVyIiwiY29sZ3JvdXAiLCJkZXB0aCIsImJlZm9yZSIsImFmdGVyIiwidGFibGUiLCJ0Ym9keSIsInRmb290IiwidGhlYWQiLCJ0ciIsImRvbUNoYW5nZXMiLCJkb2N1bWVudCIsIkRPTUNoYW5nZXNDbGFzcyIsInNob3VsZEFwcGx5Rml4IiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImluc2VydEhUTUxCZWZvcmUiLCJwYXJlbnQiLCJuZXh0U2libGluZyIsImh0bWwiLCJwYXJlbnRUYWciLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJ3cmFwcGVyIiwidW5kZWZpbmVkIiwiZml4SW5uZXJIVE1MIiwidHJlZUNvbnN0cnVjdGlvbiIsIkRPTVRyZWVDb25zdHJ1Y3Rpb25DbGFzcyIsInJlZmVyZW5jZU5vZGUiLCJyZWZlcmVuY2UiLCJ3cmFwcGVkSHRtbCIsImlubmVySFRNTCIsInBhcmVudE5vZGUiLCJpIiwiY2hpbGROb2RlcyIsImZpcnN0IiwibGFzdCIsImUiLCJsZW5ndGgiXSwibWFwcGluZ3MiOiI7Ozs7O1FBaUJPLEFBQVM7UUFvQlQsQUFBUzs7QUFyQ2hCLEFBQVMsQUFBc0I7O0FBQy9CLEFBQVMsQUFBdUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDaEMsSUFBSTtjQUNVLEVBQUUsT0FBRixBQUFTLEdBQUcsUUFBWixBQUFvQixxQkFBcUIsT0FEaEMsQUFDVCxBQUFnRCxBQUMxRDtXQUFPLEVBQUUsT0FBRixBQUFTLEdBQUcsUUFBWixBQUFvQixXQUFXLE9BRm5CLEFBRVosQUFBc0MsQUFDN0M7V0FBTyxFQUFFLE9BQUYsQUFBUyxHQUFHLFFBQVosQUFBb0Isa0JBQWtCLE9BSDFCLEFBR1osQUFBNkMsQUFDcEQ7V0FBTyxFQUFFLE9BQUYsQUFBUyxHQUFHLFFBQVosQUFBb0Is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QkFBYSxXQUFBLEFBQVcsV0FBeEIsQUFBYSxBQUFzQixBQUN0QztBQU53RDs7MkJBT3JDLDZCQUFBLEFBQWdCLFlBQWhCLEFBQTRCLFFBUFMsQUFPckMsQUFBb0M7UUFQQyxBQU9wRCx5QkFQb0Q7UUFBQSxBQU83Qyx3QkFDWjs7V0FBTyxBQUFJLDJCQUFKLEFBQW1CLFFBQW5CLEFBQTJCLE9BQWxDLEFBQU8sQUFBa0MsQUFDNUM7O0FBQ0QsU0FBQSxBQUFTLGVBQVQsQUFBd0IsVUFBVSxBQUM5QjtRQUFJLFFBQVEsU0FBQSxBQUFTLGNBQXJCLEFBQVksQUFBdUIsQUFDbkM7UUFBSSxBQUNBO2NBQUEsQUFBTSxZQUFOLEFBQWtCLEFBQ3JCO0FBRkQsTUFFRSxPQUFBLEFBQU8sR0FBRyxBQUFFLENBRmQsVUFFdUIsQUFDbkI7WUFBSSxNQUFBLEFBQU0sV0FBTixBQUFpQixXQUFyQixBQUFnQyxHQUFHLEFBQy9CO0FBQ0E7bUJBQUEsQUFBTyxBQUNWO0FBQ0o7QUFDRDtXQUFBLEFBQU8sQUFDViIsImZpbGUiOiJsaWIvY29tcGF0L2lubmVyLWh0bWwtZml4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uY3JldGVCb3VuZHMgfSBmcm9tICcuLi9ib3VuZHMnO1xuaW1wb3J0IHsgbW92ZU5vZGVzQmVmb3JlIH0gZnJvbSAnLi4vZG9tL2hlbHBlcic7XG5sZXQgaW5uZXJIVE1MV3JhcHBlciA9IHtcbiAgICBjb2xncm91cDogeyBkZXB0aDogMiwgYmVmb3JlOiAnPHRhYmxlPjxjb2xncm91cD4nLCBhZnRlcjogJzwvY29sZ3JvdXA+PC90YWJsZT4nIH0sXG4gICAgdGFibGU6IHsgZGVwdGg6IDEsIGJlZm9yZTogJzx0YWJsZT4nLCBhZnRlcjogJzwvdGFibGU+JyB9LFxuICAgIHRib2R5OiB7IGRlcHRoOiAyLCBiZWZvcmU6ICc8dGFibGU+PHRib2R5PicsIGFmdGVyOiAnPC90Ym9keT48L3RhYmxlPicgfSxcbiAgICB0Zm9vdDogeyBkZXB0aDogMiwgYmVmb3JlOiAnPHRhYmxlPjx0Zm9vdD4nLCBhZnRlcjogJzwvdGZvb3Q+PC90YWJsZT4nIH0sXG4gICAgdGhlYWQ6IHsgZGVwdGg6IDIsIGJlZm9yZTogJzx0YWJsZT48dGhlYWQ+JywgYWZ0ZXI6ICc8L3RoZWFkPjwvdGFibGU+JyB9LFxuICAgIHRyOiB7IGRlcHRoOiAzLCBiZWZvcmU6ICc8dGFibGU+PHRib2R5Pjx0cj4nLCBhZnRlcjogJzwvdHI+PC90Ym9keT48L3RhYmxlPicgfVxufTtcbi8vIFBhdGNoOiAgICBpbm5lckhUTUwgRml4XG4vLyBCcm93c2VyczogSUU5XG4vLyBSZWFzb246ICAgSUU5IGRvbid0IGFsbG93IHVzIHRvIHNldCBpbm5lckhUTUwgb24gY29sLCBjb2xncm91cCwgZnJhbWVzZXQsXG4vLyAgICAgICAgICAgaHRtbCwgc3R5bGUsIHRhYmxlLCB0Ym9keSwgdGZvb3QsIHRoZWFkLCB0aXRsZSwgdHIuXG4vLyBGaXg6ICAgICAgV3JhcCB0aGUgaW5uZXJIVE1MIHdlIGFyZSBhYm91dCB0byBzZXQgaW4gaXRzIHBhcmVudHMsIGFwcGx5IHRoZVxuLy8gICAgICAgICAgIHdyYXBwZWQgaW5uZXJIVE1MIG9uIGEgZGl2LCB0aGVuIG1vdmUgdGhlIHVud3JhcHBlZCBub2RlcyBpbnRvIHRoZVxuLy8gICAgICAgICAgIHRhcmdldCBwb3NpdGlvbi5cbmV4cG9ydCBmdW5jdGlvbiBkb21DaGFuZ2VzKGRvY3VtZW50LCBET01DaGFuZ2VzQ2xhc3MpIHtcbiAgICBpZiAoIWRvY3VtZW50KSByZXR1cm4gRE9NQ2hhbmdlc0NsYXNzO1xuICAgIGlmICghc2hvdWxkQXBwbHlGaXgoZG9jdW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBET01DaGFuZ2VzQ2xhc3M7XG4gICAgfVxuICAgIGxldCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICByZXR1cm4gY2xhc3MgRE9NQ2hhbmdlc1dpdGhJbm5lckhUTUxGaXggZXh0ZW5kcyBET01DaGFuZ2VzQ2xhc3Mge1xuICAgICAgICBpbnNlcnRIVE1MQmVmb3JlKHBhcmVudCwgbmV4dFNpYmxpbmcsIGh0bWwpIHtcbiAgICAgICAgICAgIGlmIChodG1sID09PSBudWxsIHx8IGh0bWwgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmluc2VydEhUTUxCZWZvcmUocGFyZW50LCBuZXh0U2libGluZywgaHRtbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcGFyZW50VGFnID0gcGFyZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGxldCB3cmFwcGVyID0gaW5uZXJIVE1MV3JhcHBlcltwYXJlbnRUYWddO1xuICAgICAgICAgICAgaWYgKHdyYXBwZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5pbnNlcnRIVE1MQmVmb3JlKHBhcmVudCwgbmV4dFNpYmxpbmcsIGh0bWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpeElubmVySFRNTChwYXJlbnQsIHdyYXBwZXIsIGRpdiwgaHRtbCwgbmV4dFNpYmxpbmcpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmVlQ29uc3RydWN0aW9uKGRvY3VtZW50LCBET01UcmVlQ29uc3RydWN0aW9uQ2xhc3MpIHtcbiAgICBpZiAoIWRvY3VtZW50KSByZXR1cm4gRE9NVHJlZUNvbnN0cnVjdGlvbkNsYXNzO1xuICAgIGlmICghc2hvdWxkQXBwbHlGaXgoZG9jdW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBET01UcmVlQ29uc3RydWN0aW9uQ2xhc3M7XG4gICAgfVxuICAgIGxldCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICByZXR1cm4gY2xhc3MgRE9NVHJlZUNvbnN0cnVjdGlvbldpdGhJbm5lckhUTUxGaXggZXh0ZW5kcyBET01UcmVlQ29uc3RydWN0aW9uQ2xhc3Mge1xuICAgICAgICBpbnNlcnRIVE1MQmVmb3JlKHBhcmVudCwgcmVmZXJlbmNlTm9kZSwgaHRtbCkge1xuICAgICAgICAgICAgaWYgKGh0bWwgPT09IG51bGwgfHwgaHRtbCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuaW5zZXJ0SFRNTEJlZm9yZShwYXJlbnQsIHJlZmVyZW5jZU5vZGUsIGh0bWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHBhcmVudFRhZyA9IHBhcmVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBsZXQgd3JhcHBlciA9IGlubmVySFRNTFdyYXBwZXJbcGFyZW50VGFnXTtcbiAgICAgICAgICAgIGlmICh3cmFwcGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuaW5zZXJ0SFRNTEJlZm9yZShwYXJlbnQsIHJlZmVyZW5jZU5vZGUsIGh0bWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpeElubmVySFRNTChwYXJlbnQsIHdyYXBwZXIsIGRpdiwgaHRtbCwgcmVmZXJlbmNlTm9kZSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gZml4SW5uZXJIVE1MKHBhcmVudCwgd3JhcHBlciwgZGl2LCBodG1sLCByZWZlcmVuY2UpIHtcbiAgICBsZXQgd3JhcHBlZEh0bWwgPSB3cmFwcGVyLmJlZm9yZSArIGh0bWwgKyB3cmFwcGVyLmFmdGVyO1xuICAgIGRpdi5pbm5lckhUTUwgPSB3cmFwcGVkSHRtbDtcbiAgICBsZXQgcGFyZW50Tm9kZSA9IGRpdjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdyYXBwZXIuZGVwdGg7IGkrKykge1xuICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5jaGlsZE5vZGVzWzBdO1xuICAgIH1cbiAgICBsZXQgW2ZpcnN0LCBsYXN0XSA9IG1vdmVOb2Rlc0JlZm9yZShwYXJlbnROb2RlLCBwYXJlbnQsIHJlZmVyZW5jZSk7XG4gICAgcmV0dXJuIG5ldyBDb25jcmV0ZUJvdW5kcyhwYXJlbnQsIGZpcnN0LCBsYXN0KTtcbn1cbmZ1bmN0aW9uIHNob3VsZEFwcGx5Rml4KGRvY3VtZW50KSB7XG4gICAgbGV0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTtcbiAgICB0cnkge1xuICAgICAgICB0YWJsZS5pbm5lckhUTUwgPSAnPHRib2R5PjwvdGJvZHk+JztcbiAgICB9IGNhdGNoIChlKSB7fSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKHRhYmxlLmNoaWxkTm9kZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAvLyBJdCB3b3JrZWQgYXMgZXhwZWN0ZWQsIG5vIGZpeCByZXF1aXJlZFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufSJdfQ==